<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Class Monitor System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .login-section, .admin-section, .public-section {
            padding: 30px;
        }
        
        .login-section {
            text-align: center;
        }
        
        .admin-section, .public-section {
            display: none;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 5px;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #219a52);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .action-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .students-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .students-table th, .students-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .students-table th {
            background: #34495e;
            color: white;
        }
        
        .status {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }
        
        .status.excellent { background: #27ae60; }
        .status.good { background: #3498db; }
        .status.average { background: #f39c12; }
        .status.poor { background: #e74c3c; }
        
        .search-container {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        
        .search-container input {
            flex: 1;
        }
        
        .top-students {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .top-student-card {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            width: 200px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .top-student-card.gold {
            background: linear-gradient(135deg, #FFD700, #D4AF37);
            transform: scale(1.1);
        }
        
        .top-student-card.silver {
            background: linear-gradient(135deg, #C0C0C0, #A8A8A8);
        }
        
        .top-student-card.bronze {
            background: linear-gradient(135deg, #CD7F32, #8C6239);
        }
        
        .user-info {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
        }

        .loading {
            text-align: center;
            padding: 20px;
            font-size: 18px;
        }

        .sync-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
        }
        
        @media (max-width: 768px) {
            .action-buttons {
                flex-direction: column;
            }
            
            .top-students {
                flex-direction: column;
                align-items: center;
            }
            
            .top-student-card.gold {
                transform: scale(1);
            }
        }
    </style>
</head>
<body>
    <div class="sync-status" id="syncStatus">üì± Local Storage</div>
    
    <div class="container">
        <header>
            <h1>üéì Class Monitor System</h1>
            <p>Monitor and manage student marks efficiently</p>
        </header>

        <!-- Login Section -->
        <section id="loginSection" class="login-section">
            <h2>Login</h2>
            <div class="form-group">
                <input type="text" id="username" placeholder="Enter username">
            </div>
            <div class="form-group">
                <input type="password" id="password" placeholder="Enter password">
            </div>
            <button class="btn" onclick="login()">Login</button>
            <div id="loginMessage" style="margin-top: 15px;"></div>
            
            <div style="margin-top: 20px; background: #e3f2fd; padding: 15px; border-radius: 8px;">
                <h3>Login Credentials:
                <p><strong>Students:</strong> best_students_class_8th / I am best</p>
            </div>
        </section>

        <!-- Public Student Section -->
        <section id="publicSection" class="public-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>üéì Class 8th Students</h2>
                <button class="btn btn-danger" onclick="logout()">Logout</button>
            </div>

            <div class="user-info">
                <strong>Welcome to Class 8th Student Portal!</strong> - View all students and search for specific students.
            </div>

            <!-- Search Bar -->
            <div class="search-container">
                <input type="text" id="searchStudent" placeholder="Search student by name..." onkeyup="searchStudents()">
                <button class="btn" onclick="loadAllStudents()">Show All</button>
            </div>

            <!-- Top Students -->
            <div id="topStudentsSection">
                <h3>üèÜ Top 3 Students</h3>
                <div id="topStudentsContent" class="top-students"></div>
            </div>

            <!-- Students List -->
            <div id="studentsList">
                <h3>üìã All Students</h3>
                <table class="students-table">
                    <thead>
                        <tr>
                            <th>Student Name</th>
                            <th>Current Marks</th>
                            <th>Status</th>
                            <th>Rank</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTableBody"></tbody>
                </table>
            </div>
        </section>

        <!-- Admin Dashboard Section -->
        <section id="adminSection" class="admin-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2>üëë Admin Dashboard</h2>
                <button class="btn btn-danger" onclick="logout()">Logout</button>
            </div>

            <div class="user-info">
                <strong>Welcome, Admin!</strong> - You have full access to manage students and marks.
            </div>

            <div id="flashMessage"></div>

            <div class="action-buttons">
                <button class="btn" onclick="showAddStudent()">‚ûï Add Student</button>
                <button class="btn" onclick="showDeductMarks()">‚ûñ Deduct Marks</button>
                <button class="btn btn-success" onclick="showAddMarks()">‚ûï Add Marks</button>
            </div>

            <!-- Add Student Form -->
            <div id="addStudentForm" class="action-box" style="display: none;">
                <h3>Add New Student</h3>
                <div class="form-group">
                    <input type="text" id="newStudentName" placeholder="Enter student full name">
                </div>
                <button class="btn" onclick="addStudent()">Add Student</button>
                <button class="btn btn-danger" onclick="hideAllForms()">Cancel</button>
            </div>

            <!-- Deduct Marks Form -->
            <div id="deductMarksForm" class="action-box" style="display: none;">
                <h3>Deduct Marks</h3>
                <div class="form-group">
                    <select id="deductStudent">
                        <option value="">Select Student</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="number" id="deductMarks" placeholder="Marks to deduct" min="1">
                </div>
                <div class="form-group">
                    <input type="text" id="deductReason" placeholder="Reason for deduction">
                </div>
                <button class="btn" onclick="deductMarks()">Deduct Marks</button>
                <button class="btn btn-danger" onclick="hideAllForms()">Cancel</button>
            </div>

            <!-- Add Marks Form -->
            <div id="addMarksForm" class="action-box" style="display: none;">
                <h3>Add Marks</h3>
                <div class="form-group">
                    <select id="addStudent">
                        <option value="">Select Student</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="number" id="addMarks" placeholder="Marks to add" min="1">
                </div>
                <div class="form-group">
                    <input type="text" id="addReason" placeholder="Reason for adding marks">
                </div>
                <button class="btn btn-success" onclick="addMarks()">Add Marks</button>
                <button class="btn btn-danger" onclick="hideAllForms()">Cancel</button>
            </div>

            <!-- Students List -->
            <div id="adminStudentsList">
                <h3>üìã Students List</h3>
                <table class="students-table">
                    <thead>
                        <tr>
                            <th>Student Name</th>
                            <th>Current Marks</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="adminStudentsTableBody"></tbody>
                </table>
            </div>
        </section>
    </div>

    <script>
        // User credentials
        const USERS = {
            'admin': { password: 'admin123', role: 'admin' },
            'best_students_class_8th': { password: 'I am best', role: 'publicStudent' }
        };

        // Default students data
        const DEFAULT_STUDENTS = {
            'Rahul Sharma': { marks: 95, history: [] },
            'Priya Patel': { marks: 88, history: [] },
            'Amit Kumar': { marks: 76, history: [] },
            'Sneha Singh': { marks: 92, history: [] },
            'Rohit Verma': { marks: 81, history: [] },
            'Neha Gupta': { marks: 89, history: [] },
            'Vikram Yadav': { marks: 72, history: [] },
            'Pooja Mishra': { marks: 96, history: [] }
        };

        // Global students variable
        let students = {};

        // Update sync status
        function updateSyncStatus(status) {
            const statusDiv = document.getElementById('syncStatus');
            if (status === 'connected') {
                statusDiv.innerHTML = '‚úÖ Data Saved';
                statusDiv.style.background = '#27ae60';
            } else if (status === 'saving') {
                statusDiv.innerHTML = 'üíæ Saving...';
                statusDiv.style.background = '#f39c12';
            } else {
                statusDiv.innerHTML = 'üì± Local Storage';
                statusDiv.style.background = '#3498db';
            }
        }

        // Load students from localStorage
        function loadStudentsFromStorage() {
            updateSyncStatus('loading');
            try {
                const localData = localStorage.getItem('classStudents');
                if (localData) {
                    students = JSON.parse(localData);
                    updateSyncStatus('connected');
                } else {
                    students = DEFAULT_STUDENTS;
                    saveStudentsToStorage();
                }
                return Promise.resolve(students);
            } catch (error) {
                console.error('Error loading data:', error);
                students = DEFAULT_STUDENTS;
                updateSyncStatus('error');
                return Promise.resolve(students);
            }
        }

        // Save students to localStorage
        function saveStudentsToStorage() {
            updateSyncStatus('saving');
            try {
                localStorage.setItem('classStudents', JSON.stringify(students));
                updateSyncStatus('connected');
                return Promise.resolve(true);
            } catch (error) {
                console.error('Error saving data:', error);
                updateSyncStatus('error');
                return Promise.resolve(false);
            }
        }

        // Login function
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const messageDiv = document.getElementById('loginMessage');

            if (!username || !password) {
                messageDiv.innerHTML = '<div style="background:#f8d7da;color:#721c24;padding:10px;border-radius:5px;">Please enter both username and password!</div>';
                return;
            }

            if (USERS[username] && USERS[username].password === password) {
                messageDiv.innerHTML = '<div style="background:#d4edda;color:#155724;padding:10px;border-radius:5px;">Loading data...</div>';
                
                try {
                    await loadStudentsFromStorage();
                    
                    document.getElementById('loginSection').style.display = 'none';
                    
                    if (USERS[username].role === 'admin') {
                        document.getElementById('adminSection').style.display = 'block';
                        loadStudents();
                    } else {
                        document.getElementById('publicSection').style.display = 'block';
                        loadPublicStudents();
                        loadTopStudents();
                    }
                    
                    // Clear login fields
                    document.getElementById('username').value = '';
                    document.getElementById('password').value = '';
                    
                } catch (error) {
                    messageDiv.innerHTML = '<div style="background:#f8d7da;color:#721c24;padding:10px;border-radius:5px;">Error loading data. Please try again.</div>';
                }
            } else {
                messageDiv.innerHTML = '<div style="background:#f8d7da;color:#721c24;padding:10px;border-radius:5px;">Invalid username or password!</div>';
            }
        }

        // Logout function
        function logout() {
            document.getElementById('adminSection').style.display = 'none';
            document.getElementById('publicSection').style.display = 'none';
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginMessage').innerHTML = '';
            hideAllForms();
        }

        // Load students for public view
        function loadPublicStudents() {
            const tableBody = document.getElementById('studentsTableBody');
            const studentsArray = Object.entries(students)
                .map(([name, data]) => ({ name, marks: data.marks }))
                .sort((a, b) => b.marks - a.marks);

            tableBody.innerHTML = studentsArray.map((student, index) => {
                const status = getStatus(student.marks);
                return `
                    <tr>
                        <td>${student.name}</td>
                        <td>${student.marks}</td>
                        <td><span class="status ${status.class}">${status.text}</span></td>
                        <td>${index + 1}</td>
                    </tr>
                `;
            }).join('');
        }

        // Search students function
        function searchStudents() {
            const searchTerm = document.getElementById('searchStudent').value.toLowerCase();
            const tableBody = document.getElementById('studentsTableBody');
            const studentsArray = Object.entries(students)
                .map(([name, data]) => ({ name, marks: data.marks }))
                .sort((a, b) => b.marks - a.marks)
                .filter(student => student.name.toLowerCase().includes(searchTerm));

            tableBody.innerHTML = studentsArray.map((student, index) => {
                const status = getStatus(student.marks);
                return `
                    <tr>
                        <td>${student.name}</td>
                        <td>${student.marks}</td>
                        <td><span class="status ${status.class}">${status.text}</span></td>
                        <td>${index + 1}</td>
                    </tr>
                `;
            }).join('');
        }

        // Load all students (reset search)
        function loadAllStudents() {
            document.getElementById('searchStudent').value = '';
            loadPublicStudents();
        }

        // Load top 3 students
        function loadTopStudents() {
            const topStudentsContent = document.getElementById('topStudentsContent');
            const studentsArray = Object.entries(students)
                .map(([name, data]) => ({ name, marks: data.marks }))
                .sort((a, b) => b.marks - a.marks)
                .slice(0, 3);
            
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            const cardClasses = ['gold', 'silver', 'bronze'];
            
            topStudentsContent.innerHTML = studentsArray.map((student, index) => {
                const status = getStatus(student.marks);
                return `
                    <div class="top-student-card ${cardClasses[index]}">
                        <div style="font-size:24px;font-weight:bold;margin-bottom:10px;">${medals[index]}</div>
                        <h3>${student.name}</h3>
                        <p><strong>Marks:</strong> ${student.marks}</p>
                        <p><strong>Status:</strong> ${status.text}</p>
                    </div>
                `;
            }).join('');
        }

        // Load students for admin
        function loadStudents() {
            const deductSelect = document.getElementById('deductStudent');
            const addSelect = document.getElementById('addStudent');
            const tableBody = document.getElementById('adminStudentsTableBody');

            deductSelect.innerHTML = addSelect.innerHTML = '<option value="">Select Student</option>';
            tableBody.innerHTML = '';

            for (const [name, data] of Object.entries(students)) {
                deductSelect.innerHTML += `<option value="${name}">${name} (${data.marks} marks)</option>`;
                addSelect.innerHTML += `<option value="${name}">${name} (${data.marks} marks)</option>`;

                const status = getStatus(data.marks);
                tableBody.innerHTML += `
                    <tr>
                        <td>${name}</td>
                        <td>${data.marks}</td>
                        <td><span class="status ${status.class}">${status.text}</span></td>
                        <td>
                            <button class="btn" onclick="viewHistory('${name}')">üìä History</button>
                            <button class="btn btn-danger" onclick="deleteStudent('${name}')">üóëÔ∏è Delete</button>
                        </td>
                    </tr>
                `;
            }
        }

        // Add new student
        async function addStudent() {
            const name = document.getElementById('newStudentName').value.trim();
            
            if (!name) {
                showFlash('Please enter student name!', 'error');
                return;
            }

            if (students[name]) {
                showFlash('Student already exists!', 'error');
                return;
            }

            students[name] = {
                marks: 100,
                history: [{
                    type: 'added',
                    marks: 100,
                    reason: 'Initial marks',
                    date: new Date().toLocaleString()
                }]
            };

            const success = await saveStudentsToStorage();
            if (success) {
                loadStudents();
                hideAllForms();
                showFlash(`Student ${name} added successfully!`, 'success');
            } else {
                showFlash('Error saving student. Please try again.', 'error');
            }
        }

        // Deduct marks
        async function deductMarks() {
            const name = document.getElementById('deductStudent').value;
            const marks = parseInt(document.getElementById('deductMarks').value);
            const reason = document.getElementById('deductReason').value.trim();

            if (!name || !marks || !reason) {
                showFlash('Please fill all fields!', 'error');
                return;
            }

            if (marks <= 0) {
                showFlash('Please enter valid marks to deduct!', 'error');
                return;
            }

            if (!students[name]) {
                showFlash('Student not found!', 'error');
                return;
            }

            if (students[name].marks - marks < 0) {
                showFlash('Cannot deduct more marks than available!', 'error');
                return;
            }

            students[name].marks -= marks;
            students[name].history.push({
                type: 'deducted',
                marks: marks,
                reason: reason,
                date: new Date().toLocaleString()
            });

            const success = await saveStudentsToStorage();
            if (success) {
                loadStudents();
                hideAllForms();
                showFlash(`Deducted ${marks} marks from ${name}. Reason: ${reason}`, 'success');
            } else {
                showFlash('Error deducting marks. Please try again.', 'error');
            }
        }

        // Add marks
        async function addMarks() {
            const name = document.getElementById('addStudent').value;
            const marks = parseInt(document.getElementById('addMarks').value);
            const reason = document.getElementById('addReason').value.trim();

            if (!name || !marks || !reason) {
                showFlash('Please fill all fields!', 'error');
                return;
            }

            if (marks <= 0) {
                showFlash('Please enter valid marks to add!', 'error');
                return;
            }

            if (!students[name]) {
                showFlash('Student not found!', 'error');
                return;
            }

            students[name].marks += marks;
            students[name].history.push({
                type: 'added',
                marks: marks,
                reason: reason,
                date: new Date().toLocaleString()
            });

            const success = await saveStudentsToStorage();
            if (success) {
                loadStudents();
                hideAllForms();
                showFlash(`Added ${marks} marks to ${name}. Reason: ${reason}`, 'success');
            } else {
                showFlash('Error adding marks. Please try again.', 'error');
            }
        }

        // View student history
        function viewHistory(studentName) {
            const student = students[studentName];
            if (!student || !student.history || student.history.length === 0) {
                alert(`No history available for ${studentName}`);
                return;
            }

            let historyHTML = `
                <div style="text-align:center;background:#34495e;color:white;padding:10px;border-radius:10px 10px 0 0;">
                    <h3>History for ${studentName}</h3>
                </div>
                <div style="max-height:400px;overflow-y:auto;padding:10px;">
            `;
            
            student.history.forEach((record, index) => {
                const color = record.type === 'added' ? '#27ae60' : '#e74c3c';
                const icon = record.type === 'added' ? '‚ûï' : '‚ûñ';
                historyHTML += `
                    <div style="background:#f8f9fa;padding:12px;margin:8px 0;border-radius:8px;border-left:4px solid ${color}">
                        <strong>${icon} ${record.type.toUpperCase()}</strong><br>
                        <strong>Marks:</strong> ${record.marks}<br>
                        <strong>Reason:</strong> ${record.reason}<br>
                        <strong>Date:</strong> ${record.date}
                    </div>
                `;
            });
            
            historyHTML += '</div>';
            
            // Create custom modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                border-radius: 10px;
                width: 90%;
                max-width: 500px;
                max-height: 80vh;
                overflow: hidden;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            modalContent.innerHTML = historyHTML;
            
            const closeButton = document.createElement('button');
            closeButton.textContent = 'Close';
            closeButton.style.cssText = `
                background: #e74c3c;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 5px;
                cursor: pointer;
                margin: 10px;
                display: block;
                margin-left: auto;
                margin-right: auto;
            `;
            closeButton.onclick = function() {
                document.body.removeChild(modal);
            };
            
            modalContent.appendChild(closeButton);
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.onclick = function(e) {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };
        }

        // Delete student
        async function deleteStudent(studentName) {
            if (confirm(`Are you sure you want to delete ${studentName}? This action cannot be undone.`)) {
                delete students[studentName];
                const success = await saveStudentsToStorage();
                if (success) {
                    loadStudents();
                    showFlash(`Student ${studentName} deleted successfully!`, 'success');
                } else {
                    showFlash('Error deleting student. Please try again.', 'error');
                }
            }
        }

        // Get status based on marks
        function getStatus(marks) {
            if (marks >= 80) return { class: 'excellent', text: 'Excellent' };
            if (marks >= 60) return { class: 'good', text: 'Good' };
            if (marks >= 40) return { class: 'average', text: 'Average' };
            return { class: 'poor', text: 'Poor' };
        }

        // Show flash messages
        function showFlash(message, type) {
            const color = type === 'success' ? '#d4edda' : '#f8d7da';
            const textColor = type === 'success' ? '#155724' : '#721c24';
            const flashDiv = document.getElementById('flashMessage');
            flashDiv.innerHTML = 
                `<div style="background:${color};color:${textColor};padding:15px;border-radius:8px;margin:20px 0;border-left:4px solid ${type === 'success' ? '#27ae60' : '#e74c3c'};">${message}</div>`;
            setTimeout(() => {
                flashDiv.innerHTML = '';
            }, 4000);
        }

        // Form display functions
        function showAddStudent() {
            hideAllForms();
            document.getElementById('addStudentForm').style.display = 'block';
        }

        function showDeductMarks() {
            hideAllForms();
            document.getElementById('deductMarksForm').style.display = 'block';
        }

        function showAddMarks() {
            hideAllForms();
            document.getElementById('addMarksForm').style.display = 'block';
        }

        function hideAllForms() {
            document.getElementById('addStudentForm').style.display = 'none';
            document.getElementById('deductMarksForm').style.display = 'none';
            document.getElementById('addMarksForm').style.display = 'none';
            
            // Clear form fields
            document.getElementById('newStudentName').value = '';
            document.getElementById('deductMarks').value = '';
            document.getElementById('deductReason').value = '';
            document.getElementById('addMarks').value = '';
            document.getElementById('addReason').value = '';
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadStudentsFromStorage();
            
            // Enter key support for login
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
        });
    </script>
</body>
</html>